{%- comment -%}
  {%- include nav_page.html 
        nodes=array 
        ancestors=array 
        path=string 
        section=string -%}
  - assigns nav_page_ancestors
  - assigns nav_page_path
  - assigns nav_page_children
  - deletes nav_* local variables
{%- endcomment -%}

{%- unless nav_page_ancestors and nav_page_path and nav_page_children -%}
  {%- include nav_sorted.html nodes=include.nodes -%}
  {%- for node in nav_sorted -%}
    {%- include nav_children.html 
          node=node
          ancestors=include.ancestors
          section=include.section -%}
    {%- assign nav_path =  include.path | append: " " | append: forloop.index -%}
    {%- if node.url == page.url -%}
      {%- assign nav_page_ancestors = include.ancestors -%}
      {%- assign nav_page_path = nav_path -%}
      {%- assign nav_page_children = nav_children -%}
      {%- break -%}
    {%- endif -%}
    {%- if nav_children.size >= 1 -%}
      {%- assign nav_ancestors = include.ancestors | push: node -%}
      {%- assign nav_section = include.section -%}
      {%- if include.section -%}
        {%- assign nav_section = include.section -%}
      {%- else -%}
        {%- assign nav_section = node.section -%}
      {%- endif -%}
      {%- include nav_page.html
            nodes=nav_children
            ancestors=nav_ancestors
            path=nav_path
            section=nav_section -%}
    {%- endif -%}
  {%- endfor -%}
{%- endunless -%}

{%- assign nav_children = nil -%}
{%- assign nav_ancestors = nil -%}
{%- assign nav_path = nil -%}
{%- assign nav_section = nil -%}
