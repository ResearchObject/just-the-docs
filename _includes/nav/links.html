{%- comment -%}
  {%- include nav/links.html 
        nodes = array 
        ancestor_titles = string 
        path = string 
        in_section = value_or_nil
        pages = array -%}
  outputs links for non-excluded nodes and their children. The links for an
  inactive node are independent of the path to the current page, but only those
  for top-level nodes are cached (assuming that large sites have more than one
  top-level node with large number of child pages).
{%- endcomment -%}

<ul class="nav-list">
{%- for node in include.nodes -%}
  {%- unless node.nav_exclude == true -%}

    {%- assign nav_path = include.path | append: " " | append: forloop.index -%}
    {%- if nav_page_path contains nav_path -%}
      {%- assign nav_active = true -%}
    {%- else -%}
      {%- assign nav_active = false -%}
    {%- endif -%}

    {%- if nav_active or site.nav_cache == false or node.parent -%}
      {%- include nav/node.html
            node = node
            ancestor_titles = include.ancestor_titles
            path = nav_path
            in_section = include.in_section
            pages = include.pages
            active = nav_active -%}
    {%- else -%}
      {%- include_cached nav/inactive_node.html
            node = node
            ancestor_titles = include.ancestor_titles
            in_section = include.in_section
            pages = include.pages
            cached = true -%}
    {%- endif -%}

  {%- endunless -%}
{%- endfor -%}
</ul>
