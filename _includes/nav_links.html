{%- comment -%}
  {%- include nav_links.html 
        nodes=array 
        ancestors=array 
        path=string 
        section=string -%}
  - uses nav_page_path
  - outputs links for the nodes and their children
  - deletes nav_* local variables
{%- endcomment -%}

<ul class="nav-list">
  {%- include nav_sorted.html nodes=include.nodes -%}
  {%- for node in nav_sorted -%}
    {%- include nav_children.html 
          node=node
          ancestors=include.ancestors
          section=include.section -%}
    {%- assign nav_path = include.path | append: " " | append: forloop.index -%}
    {%- if nav_page_path contains nav_path -%}
      {%- assign nav_active = true -%}
    {%- else -%}
      {%- assign nav_active = false -%}
    {%- endif -%}
    <li class="nav-list-item{% if nav_active %} active{% endif %}">
      {%- if nav_children.size >= 1 -%}
        <a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a>
      {%- endif -%}
      <a href="{{ node.url | absolute_url }}" class="nav-list-link{% if nav_active %} active{% endif %}">{{ node.title }}</a>
      {%- if nav_children.size >= 1 -%}
        {%- assign nav_ancestors =  include.ancestors | push: node -%}
        {%- if include.section -%}
          {%- assign nav_section = include.section -%}
        {%- else -%}
          {%- assign nav_section = node.section -%}
        {%- endif -%}
        {%- include nav_links.html
              nodes=nav_children
              ancestors=nav_ancestors
              path=nav_path
              section=nav_section -%}
      {%- endif -%}
    </li>
  {%- endfor -%}
</ul>

{%- assign nav_children = nil -%}
{%- assign nav_ancestors = nil -%}
{%- assign nav_path = nil -%}
{%- assign nav_section = nil -%}
